# 工作流建模

### 工作流概念
#### 案例
- 工作流系统的基本目的是处理案例(保险索赔，抵押申请，下订单，就诊)
- 每个案例都有唯一的 **标识**
- 每个案例的生命周期都是有限的
- 案例状态
    + 案例相关的属性值：案例属性是一系列同案例相关的变量，能够用来管理案例
    + 已经满足的条件：条件用来确定哪些任务已经被执行，哪些任务还要被执行。
    + 案例的内容：工作流系统通常不保存案例内容的细节。包括文档，文件，档案。

#### 任务
- 任务是一个工作的逻辑单元，它不可分割且必须完整执行。(键入一封信，评估一个评价报告)
- 任务泛指一般的工作单元，并非某案例活动的一次具体执行。为了避免把任务本身同作为某案例一部分的任务执行相混淆，我们引入术语工作项(work item)和活动(activity)
    + 工作项就是案例和将要执行的任务的结合体，只要案例状态允许，工作项就被创建。
    + 活动是指工作项的实际执行
```
    task -> work item  -> activity
                ^
                |
               case

```

#### 过程
- 某种案例的执行方式由相关的过程来描述。过程指出了哪些任务需要被执行，以什么次序执行。
- 我们可以把过程看作是某种类型案例的程序。
- 通常一个过程可以用来处理多个不同的案例，根据案例属性采取不同的措施。
- 本质上，过程由任务和条件构成
- 过程定义了案例的生命周期

##### 路由
- 过程决定了案例的生命周期，我们称之为案例的“路由”，沿着特定分支的路由决定哪些任务需要被执行。
- 路由案例的四种基本结构
    + 最简单的路由形式是任务的顺序执行。通常它们之间存在清晰的依赖关系。
    + 如果两个人物能同时或以任意次序执行，我们称之为并行路由。
    + 当在两个或者更多任务之间存在选择时，我们称之为选择路由。也成为条件路由。该选择可能依赖于案例相关属性所体现的性质。
    + 在理想条件下，对于每个案例的一个任务的执行都不超过一次，然而有的时候需要多次执行某个人物，我们称之为循环(迭代)路由

##### 启动
- 只有当案例的状态允许的时候，一个工作项才能被执行。但是实际执行一个工作项，通常还需要其他前提，我们称之为触发：工作项由一个资源(如一个雇员)启动。
- 触发分成三类：
    + 资源驱动
    + 外部事件
    + 时间信号
- 如果工作项不需要外部激励并总是必须立即执行，则不需要触发。

### Petri网
#### 组成
- 库所(token)：库所可以容纳标记，标记用墨点
- 变迁(transition)：
    + 每个变迁都有一个输入库所和输出库所。
    + 变迁只有满足实施条件才能实施，也就是每个输入库所都至少有一个标记，变迁才能被“装弹”，实施就绪。
    + 变迁一旦就绪即可实施，变迁实施时，从它的每个输入库所都取走一个标记，并往它的输入库所都增加一个标记。
- 有向弧
    + 从变迁到库所
    + 从库所到变迁

#### 高级Petri网
- 颜色扩展
    + 用"颜色"对传统的Petri网进行了扩展，这种扩展确保每个标记都被提供一个值，即颜色。
    + 变迁实施所产生的标记，取决于实施时候被消耗的标记的值，生产出的标记的值也可以依赖于那些被消耗的标记的值。
    + 与传统的Petri不同，生产的标记的数目也是变化的，即生产出的标记数目由被消耗的标记的值来决定。
    + 在经过颜色扩展的Petri网中，我们可以为要被消耗的标记的值设置前置条件，这样，变迁只有在每个输入库所中都有一个标记并且满足前置条件时候才能就绪。
    + 设置了前置条件之后，与传统Petri网不同，输出库所可以不接受标记.

- 时间扩展
    + 通常我们希望对一个过程的预期性能进行判断时，就通过时间扩展的Petri网建模。
    + 采用时间扩展，标记时间将时间戳作为一个值，该事件戳指明标记自何时可用。
    + 标记的消耗按照先进先出的规则，也就是拥有最早时间戳的标记首先被消耗，此外，拥有最早就绪时刻的变迁首先被实施。
    + 如果嗦个变迁具有具有相同的就绪时刻，就出现了不确定性选择。而且一个变迁的实施可能影响另外一个变迁的就绪时刻。

- 层次扩展

### 工作流概念到Petri网的映射
#### 过程
原则上，每个过程都要符合两个要求
- 任何时候，通过一系列任务的执行，都能达到end中有一个标记的状态。
- end中有标记时，所有其他库所中的标记要消失。

