### 概述运输层服务
#### 运输层与网络层的关系
- 运输层协议为运行在不同主机上的应用进程提供了逻辑通信。运输层协议只工作在端系统
- 网络层提供了主机之间的通信

####  多路复用与多路分解
- 将运输层报文字段中的数据交付到正确的套接字的工作成为多路分解
- 从源主机的不同套接字中收集数据块，并为每个数据块封装首部信息从而生成报文段，然后将报文段传递到网络层的工作成为多路复用。
- 一个UDP套接字是由一个包含目的IP地址和目的端口号的二元组来全面表示的

#### 无连接运输：UDP
- UDP的优点
	+ 应用层能更好的控制要发送的数据和时间。采用UDP的时候，只要应用进程将数据传递给UDP，UDP就会将此数据打包生成UDP报文段并立即将其传递给网络层。
	+ 无需连接建立(DNS运行在UDP而不是TCP之上)
	+ 无连接状态：TCP在端系统中需要维护连接状态，次连接状态包括接受和发送缓存，拥塞控制参数，需要与确认号的参数。
	+ 分组首部开销小
- UDP校验和
	+ 发送方
		+ 发送方将分组中的内容当做一系列16比特字
		+ 将所有的比特字的和进行反码运算
		+ 将检验和放入UDP报文段
	+ 接收方
		+ 计算接收到的比特字和并与检验和相加
		+ 如果分组没有差错，接受方的和全部是1，如果有差错，将会出现0

#### 可靠数据传输协议
##### 构造可靠数据传输协议
- 完全可靠信道上的可靠数据传输协议：rdt1.0
	+ 有了完全可靠的信道，接收方就不需要提供任何反馈信息给发送方，因为不会发生任何差错
- 具有比特差错信道上的可靠数据传输协议：rdt2.0
	+ 处理差错比特有三种协议
		+ 差错检测：要求有额外的比特从发送方到接收方，这些比特将被汇集到rdt2.0数据分组检验和字段中
		+ 接收方反馈：接受方方向返回ACK和NCK分组
		+ 重传：接受方接收到有差错的分组时，发送方将重传该分组

	+ 如果发送方收到一个NAK分组，该协议重传最后一个分组并等待接受方返回想相应重传分组的ACK或者NAK
	+ 当发送方在等待ACK或者NAK的时候，它不能从上层获得更多的数据，仅当接收到ACK并且离开该状态时才能继续获取数据。因此发送方不会发送一块新的数据，直到发送方确信正确收到当前分组为止。因此rst2.0被称为停等协议。
- 具有比特差错信道上实现一个数据标序号的可靠数据传输协议：rdt2.1
	+ 数组分组中添加新的字段，让发送方对其数据分组编号。
	+ 发送方发送数据之后期待接收方返回的ACK或者NAK的值与当前数据分组的序号相同
- 具有比特差错信道上实现一个无NAK的可靠数据传输协议：rdt2.2
	+ 如果当前分组的序号是0，那么就应该接收到的ACK的值是0，如果接收到的ACK的值是1，说明出错了。
	+ 如果当前分组的序号是1，那么就应该接收到的ACK的值是1，如果接收到的ACK的值是0，说明出错了
	+ 通过上述两步，实现了无NAK的可靠数据传输协议
- 具有差错比特的丢包信道上的可靠数据传输：rdt3.0